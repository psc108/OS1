# SecureOS Bootstrap - Minimal Working Version
# Uses existing base container without package installation
FROM secureos/secureos:1.0.0

USER root

# Set up LFS environment variables
ENV LFS=/mnt/lfs
ENV LFS_TGT=x86_64-lfs-linux-gnu
ENV PATH=/tools/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
ENV CONFIG_SITE=/mnt/lfs/usr/share/config.site

# Create directories and basic setup
RUN mkdir -p /opt/secureos/{build,sources,tools} && \
    mkdir -p $LFS/{etc,var} $LFS/usr/{bin,lib,sbin} $LFS/sources $LFS/tools && \
    for i in bin lib sbin; do ln -sf usr/$i $LFS/$i; done && \
    chmod a+wt $LFS/sources && \
    ln -sf $LFS/tools / && \
    mkdir -p /root/rpmbuild/{BUILD,RPMS,SOURCES,SPECS,SRPMS}

# Copy Phase 3/4/5 security components
COPY build_context/phase3/core_systems/ /opt/secureos/core_systems/
COPY build_context/phase4/system_services/ /opt/secureos/system_services/
COPY build_context/phase5/user_space/ /opt/secureos/user_space/

# Copy build scripts
COPY build_context/prepare_build_environment.sh /usr/local/bin/
COPY build_context/start_os_build.sh /usr/local/bin/
RUN chmod +x /usr/local/bin/*.sh

# Create deployment type marker
RUN echo "docker" > /etc/secureos-deployment-type

WORKDIR /opt/secureos

CMD ["/bin/sh", "-c", "echo 'ğŸ‰ SecureOS Bootstrap Environment (Minimal)'; echo 'âœ… LFS environment: $LFS'; echo 'âœ… Security components in /opt/secureos/'; echo 'âš ï¸  Development tools need manual installation'; echo 'Ready for development setup!'; /bin/sh"]